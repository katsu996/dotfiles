{{- if eq.chezmoi.os "darwin" -}}
#!/bin/bash

# HomebrewãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
if! which -s "brew"; then
    echo "ğŸº Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo "âœ… Homebrew installed successfully."
fi

# å…±é€šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
echo "Applying common Homebrew packages..."
brew bundle --file=/dev/stdin <<EOF
{{ range.packages.darwin.brews.common -}}
brew {{. | quote }}
{{ end -}}
{{ range.packages.darwin.casks.common -}}
cask {{. | quote }}
{{ end -}}
EOF

# ãƒ­ãƒ¼ãƒ«ï¼ˆä»•äº‹ç”¨/å€‹äººç”¨ï¼‰ã«å¿œã˜ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
echo "Applying role-specific Homebrew packages..."
brew bundle --file=/dev/stdin <<EOF
{{ if eq.data.role "work" -}}
{{ range.packages.darwin.brews.work -}}
brew {{. | quote }}
{{ end -}}
{{ range.packages.darwin.casks.work -}}
cask {{. | quote }}
{{ end -}}
{{ else if eq.data.role "personal" -}}
{{ range.packages.darwin.brews.personal -}}
brew {{. | quote }}
{{ end -}}
{{ range.packages.darwin.casks.personal -}}
cask {{. | quote }}
{{ end -}}
{{ end -}}
EOF
{{ end -}}